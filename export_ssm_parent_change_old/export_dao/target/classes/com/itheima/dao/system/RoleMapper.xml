<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itheima.dao.system.RoleMapper">

    <resultMap id="map1" type="role">
        <id property="id" column="role_id"/>
        <result property="name" column="name"/>
        <result property="remark" column="remark"/>
        <result property="orderNo" column="order_no"/>
        <result property="companyId" column="company_id"/>
        <result property="companyName" column="company_name"/>
    </resultMap>

    <select id="findAll" resultMap="map1" parameterType="string">
        SELECT * from pe_role WHERE company_id = #{companyId}
    </select>

    <select id="findById" parameterType="string" resultMap="map1">
        SELECT * from pe_role where role_id = #{roleId}
    </select>

    <update id="update" parameterType="role">
        update pe_role
        set
        name = #{name},
        remark = #{remark},
        order_no = #{orderNo},
        company_id = #{companyId},
        company_name = #{companyName}
        where role_id = #{id}
    </update>

    <insert id="save" parameterType="role">
        INSERT INTO pe_role(
        role_id,
        name,
        remark,
        order_no,
        company_id,
        company_name
        )
        VALUES (
        #{id},
        #{name},
        #{remark},
        #{orderNo},
        #{companyId},
        #{companyName}
        )
    </insert>

    <delete id="delete" parameterType="string">
        DELETE from pe_role where role_id = #{roleId}
    </delete>

    <select id="findTreeList" parameterType="string" resultType="java.util.Map">
        SELECT module_id AS id,parent_id AS pId,
        NAME AS name,CASE WHEN module_id IN
        (SELECT module_id FROM pe_role_module WHERE role_id = #{roleId})
        THEN 'true' ELSE 'false' END AS checked
        FROM ss_module
    </select>

    <delete id="deleteModuleById" parameterType="string">
        DELETE FROM pe_role_module where role_id = #{roleId}
    </delete>

    <insert id="saveModuleMapper" parameterType="java.util.Map">
        INSERT INTO pe_role_module VALUES (#{roleId},#{moduleId})
    </insert>

    <select id="findRoleByUid" resultType="string" parameterType="string">
        SELECT role_id FROM pe_role WHERE role_id IN
        (SELECT role_id FROM pe_role_user WHERE user_id = #{userId})
    </select>

</mapper>