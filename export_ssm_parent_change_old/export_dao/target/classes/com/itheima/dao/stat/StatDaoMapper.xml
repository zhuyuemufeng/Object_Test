<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.itheima.dao.stat.StatDaoMapper">

    <select id="findFactorySellData" parameterType="string" resultType="java.util.Map">
        SELECT factory_name name,SUM(amount) value FROM co_contract_product
        WHERE company_id = #{companyId} GROUP BY factory_name
    </select>
    
    <select id="findProductSellData" parameterType="string" resultType="java.util.Map">
        SELECT * FROM (
        SELECT product_no name,SUM(cnumber) value FROM co_contract_product
        WHERE company_id = #{companyId} GROUP BY product_no ORDER BY VALUE DESC
        ) a LIMIT 15
    </select>

    <select id="findOnlineData" parameterType="string" resultType="java.util.Map">
        SELECT a.A1 name,IFNULL(b.value,0) value
        FROM st_online_info a LEFT JOIN (
        SELECT DATE_FORMAT(TIME,'%H') NAME,COUNT(*) VALUE
        FROM st_sys_log WHERE company_id = #{companyId} GROUP BY NAME
        ) b ON a.A1 = b.name
    </select>
    
</mapper>